    !cpu 6502
    !to "plots.prg",cbm

    *= $0801

    lda #$00
    sta $d020
    sta $d021

    jsr clrscr
    jsr initgfx
    ;jsr gentables

    sei
    lda #$7f
    sta $dc0d
    sta $dd0d
    lda $dc0d
    lda $dd0d
    lda #$01
    sta $d01a
    lda #$00
    sta $d012
    lda #<irqmain
    sta $fffe
    lda #>irqmain
    sta $ffff
    lda #$3b
    sta $d011
    lda #$18
    sta $d018
    lda #$35
    sta $01
    cli
    jmp *


clrscr
    ldx #$00
clrscr_loop
    lda #$10
    sta $0400,x
    sta $0500,x
    sta $0600,x
    sta $06e8,x
    lda #$01
    sta $d800,x
    sta $d900,x
    sta $da00,x
    sta $dae8,x
    inx
    bne clrscr_loop
    rts


initgfx
    lda #$00
    ldx #$00
initgfx_sta
    sta $2000,x
    inx
    bne initgfx_sta
    ldy initgfx_sta+2
    iny
    sty initgfx_sta+2
    cpy #$40
    bne initgfx_sta
    rts

irqmain
    pha
    txa
    pha
    tya
    pha

    lda #$00
    sta $d020
    ldx #$00
    clc
loopy1
    ldy dotsy,x
    jsr plotdot
    inx
bne loopy1
loopy2
    ldy dotsy+1,x
    sec
    jsr plotdot
    inx
    cpx #$40
    bne loopy2
    lda #$02
    sta $d020
lda #$01
    sta $d019
    pla
    tay
    pla
    tax
    pla
    rti


plotdot  ; x,y = coords
         ; carry = shift 256 px >>
    lda y_tbl_lo,y
    sta $fb
    bcs carryshift
    lda y_tbl_hi,y
    sta $fc
    ldy x_tbl,x
    lda xdot_tbl,x
    ora ($fb),y
    sta ($fb),y
    rts
carryshift
    lda y_tbl_hi+256,y
    sta $fc
    ldy x_tbl,x
    lda xdot_tbl,x
    ora ($fb),y
    sta ($fb),y
    rts


cleardot ; x,y = coords
         ; carry = shift 256 px >>
    lda y_tbl_lo,y
    sta $fb
    bcs carryshift
    lda y_tbl_hi,y
    sta $fc
    ldy x_tbl,x
    lda #$00
    sta ($fb),y
    rts
carryshift
    lda y_tbl_hi+256,y
    sta $fc
    ldy x_tbl,x
    lda #$00
    sta ($fb),y
    rts


!align 255,0
dotsy
    !byte $64,$5F,$5A,$55,$50,$4B,$46,$42,$3D,$39,$34,$30,$2C,$28,$24,$20
    !byte $1D,$19,$16,$13,$10,$0E,$0B,$09,$07,$05,$04,$02,$01,$01,$00,$00
    !byte $00,$00,$00,$01,$02,$03,$04,$06,$07,$09,$0C,$0E,$11,$14,$17,$1A
    !byte $1D,$21,$25,$29,$2D,$31,$35,$3A,$3E,$43,$47,$4C,$51,$56,$5B,$60
    !byte $64,$69,$6E,$73,$78,$7D,$82,$86,$8B,$8F,$94,$98,$9C,$A0,$A4,$A8
    !byte $AB,$AE,$B2,$B5,$B7,$BA,$BC,$BE,$C0,$C2,$C4,$C5,$C6,$C7,$C7,$C7
    !byte $C7,$C7,$C7,$C6,$C5,$C4,$C3,$C1,$BF,$BD,$BB,$B8,$B6,$B3,$B0,$AC
    !byte $A9,$A5,$A2,$9E,$9A,$95,$91,$8D,$88,$83,$7F,$7A,$75,$70,$6B,$66
    !byte $62,$5D,$58,$53,$4E,$49,$45,$40,$3B,$37,$32,$2E,$2A,$26,$22,$1F
    !byte $1B,$18,$15,$12,$0F,$0D,$0A,$08,$06,$05,$03,$02,$01,$00,$00,$00
    !byte $00,$00,$00,$01,$02,$03,$05,$06,$08,$0A,$0D,$0F,$12,$15,$18,$1B
    !byte $1F,$22,$26,$2A,$2E,$32,$37,$3B,$40,$45,$49,$4E,$53,$58,$5D,$62
    !byte $66,$6B,$70,$75,$7A,$7F,$83,$88,$8D,$91,$95,$9A,$9E,$A2,$A5,$A9
    !byte $AC,$B0,$B3,$B6,$B8,$BB,$BD,$BF,$C1,$C3,$C4,$C5,$C6,$C7,$C7,$C7
    !byte $C7,$C7,$C7,$C6,$C5,$C4,$C2,$C0,$BE,$BC,$BA,$B7,$B5,$B2,$AE,$AB
    !byte $A8,$A4,$A0,$9C,$98,$94,$8F,$8B,$86,$82,$7D,$78,$73,$6E,$69,$64
    !byte $60,$5B,$56,$51,$4C,$47,$43,$3E,$3A,$35,$31,$2D,$29,$25,$21,$1D
    !byte $1A,$17,$14,$11,$0E,$0C,$09,$07,$06,$04,$03,$02,$01,$00,$00,$00
    !byte $00,$00,$01,$01,$02,$04,$05,$07,$09,$0B,$0E,$10,$13,$16,$19,$1D
    !byte $20,$24,$28,$2C,$30,$34,$39,$3D,$42,$46,$4B,$50,$55,$5A,$5F,$63

    *= $0b00
xdot_tbl
    !byte $80, $40, $20, $10, $08, $04, $02, $01
    !byte $80, $40, $20, $10, $08, $04, $02, $01
    !byte $80, $40, $20, $10, $08, $04, $02, $01
    !byte $80, $40, $20, $10, $08, $04, $02, $01
    !byte $80, $40, $20, $10, $08, $04, $02, $01
    !byte $80, $40, $20, $10, $08, $04, $02, $01
    !byte $80, $40, $20, $10, $08, $04, $02, $01
    !byte $80, $40, $20, $10, $08, $04, $02, $01
    !byte $80, $40, $20, $10, $08, $04, $02, $01
    !byte $80, $40, $20, $10, $08, $04, $02, $01
    !byte $80, $40, $20, $10, $08, $04, $02, $01
    !byte $80, $40, $20, $10, $08, $04, $02, $01
    !byte $80, $40, $20, $10, $08, $04, $02, $01
    !byte $80, $40, $20, $10, $08, $04, $02, $01
    !byte $80, $40, $20, $10, $08, $04, $02, $01
    !byte $80, $40, $20, $10, $08, $04, $02, $01
    !byte $80, $40, $20, $10, $08, $04, $02, $01
    !byte $80, $40, $20, $10, $08, $04, $02, $01
    !byte $80, $40, $20, $10, $08, $04, $02, $01
    !byte $80, $40, $20, $10, $08, $04, $02, $01
    !byte $80, $40, $20, $10, $08, $04, $02, $01
    !byte $80, $40, $20, $10, $08, $04, $02, $01
    !byte $80, $40, $20, $10, $08, $04, $02, $01
    !byte $80, $40, $20, $10, $08, $04, $02, $01
    !byte $80, $40, $20, $10, $08, $04, $02, $01
    !byte $80, $40, $20, $10, $08, $04, $02, $01
    !byte $80, $40, $20, $10, $08, $04, $02, $01
    !byte $80, $40, $20, $10, $08, $04, $02, $01
    !byte $80, $40, $20, $10, $08, $04, $02, $01
    !byte $80, $40, $20, $10, $08, $04, $02, $01
    !byte $80, $40, $20, $10, $08, $04, $02, $01
    !byte $80, $40, $20, $10, $08, $04, $02, $01

!align 255,0
y_tbl_hi
    !byte $20,$20,$20,$20,$20,$20,$20,$20 ; 00
    !byte $21,$21,$21,$21,$21,$21,$21,$21 ; 40
    !byte $22,$22,$22,$22,$22,$22,$22,$22 ; 80
    !byte $23,$23,$23,$23,$23,$23,$23,$23 ; c0
    !byte $25,$25,$25,$25,$25,$25,$25,$25 ; 00
    !byte $26,$26,$26,$26,$26,$26,$26,$26 ; 40
    !byte $27,$27,$27,$27,$27,$27,$27,$27 ; 80
    !byte $28,$28,$28,$28,$28,$28,$28,$28 ; c0
    !byte $2a,$2a,$2a,$2a,$2a,$2a,$2a,$2a ; 00
    !byte $2b,$2b,$2b,$2b,$2b,$2b,$2b,$2b ; 40
    !byte $2c,$2c,$2c,$2c,$2c,$2c,$2c,$2c ; 80
    !byte $2d,$2d,$2d,$2d,$2d,$2d,$2d,$2d ; c0
    !byte $2f,$2f,$2f,$2f,$2f,$2f,$2f,$2f ; 00
    !byte $30,$30,$30,$30,$30,$30,$30,$30 ; 40
    !byte $31,$31,$31,$31,$31,$31,$31,$31 ; 80
    !byte $32,$32,$32,$32,$32,$32,$32,$32 ; c0
    !byte $34,$34,$34,$34,$34,$34,$34,$34 ; 00
    !byte $35,$35,$35,$35,$35,$35,$35,$35 ; 40
    !byte $36,$36,$36,$36,$36,$36,$36,$36 ; 80
    !byte $37,$37,$37,$37,$37,$37,$37,$37 ; c0
    !byte $39,$39,$39,$39,$39,$39,$39,$39 ; 00
    !byte $3a,$3a,$3a,$3a,$3a,$3a,$3a,$3a ; 40
    !byte $3b,$3b,$3b,$3b,$3b,$3b,$3b,$3b ; 80
    !byte $3c,$3c,$3c,$3c,$3c,$3c,$3c,$3c ; c0
    !byte $3e,$3e,$3e,$3e,$3e,$3e,$3e,$3e ; 00

!align 255,0
    !byte $21,$21,$21,$21,$21,$21,$21,$21 ; 00
    !byte $22,$22,$22,$22,$22,$22,$22,$22 ; 40
    !byte $23,$23,$23,$23,$23,$23,$23,$23 ; 80
    !byte $24,$24,$24,$24,$24,$24,$24,$24 ; c8
    !byte $26,$26,$26,$26,$26,$26,$26,$26
    !byte $27,$27,$27,$27,$27,$27,$27,$27
    !byte $28,$28,$28,$28,$28,$28,$28,$28
    !byte $29,$29,$29,$29,$29,$29,$29,$29
    !byte $2b,$2b,$2b,$2b,$2b,$2b,$2b,$2b
    !byte $2c,$2c,$2c,$2c,$2c,$2c,$2c,$2c
    !byte $2d,$2d,$2d,$2d,$2d,$2d,$2d,$2d
    !byte $2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
    !byte $30,$30,$30,$30,$30,$30,$30,$30
    !byte $31,$31,$31,$31,$31,$31,$31,$31
    !byte $32,$32,$32,$32,$32,$32,$32,$32
    !byte $33,$33,$33,$33,$33,$33,$33,$33
    !byte $35,$35,$35,$35,$35,$35,$35,$35
    !byte $36,$36,$36,$36,$36,$36,$36,$36
    !byte $37,$37,$37,$37,$37,$37,$37,$37
    !byte $38,$38,$38,$38,$38,$38,$38,$38
    !byte $3a,$3a,$3a,$3a,$3a,$3a,$3a,$3a
    !byte $3b,$3b,$3b,$3b,$3b,$3b,$3b,$3b
    !byte $3c,$3c,$3c,$3c,$3c,$3c,$3c,$3c
    !byte $3d,$3d,$3d,$3d,$3d,$3d,$3d,$3d
    !byte $3f,$3f,$3f,$3f,$3f,$3f,$3f,$3f

!align 255,0
y_tbl_lo
    !byte $00,$01,$02,$03,$04,$05,$06,$07
    !byte $40,$41,$42,$43,$44,$45,$46,$47
    !byte $80,$81,$82,$83,$84,$85,$86,$87
    !byte $c0,$c1,$c2,$c3,$c4,$c5,$c6,$c7
    !byte $00,$01,$02,$03,$04,$05,$06,$07
    !byte $40,$41,$42,$43,$44,$45,$46,$47
    !byte $80,$81,$82,$83,$84,$85,$86,$87
    !byte $c0,$c1,$c2,$c3,$c4,$c5,$c6,$c7
    !byte $00,$01,$02,$03,$04,$05,$06,$07
    !byte $40,$41,$42,$43,$44,$45,$46,$47
    !byte $80,$81,$82,$83,$84,$85,$86,$87
    !byte $c0,$c1,$c2,$c3,$c4,$c5,$c6,$c7
    !byte $00,$01,$02,$03,$04,$05,$06,$07
    !byte $40,$41,$42,$43,$44,$45,$46,$47
    !byte $80,$81,$82,$83,$84,$85,$86,$87
    !byte $c0,$c1,$c2,$c3,$c4,$c5,$c6,$c7
    !byte $00,$01,$02,$03,$04,$05,$06,$07
    !byte $40,$41,$42,$43,$44,$45,$46,$47
    !byte $80,$81,$82,$83,$84,$85,$86,$87
    !byte $c0,$c1,$c2,$c3,$c4,$c5,$c6,$c7
    !byte $00,$01,$02,$03,$04,$05,$06,$07
    !byte $40,$41,$42,$43,$44,$45,$46,$47
    !byte $80,$81,$82,$83,$84,$85,$86,$87
    !byte $c0,$c1,$c2,$c3,$c4,$c5,$c6,$c7
    !byte $00,$01,$02,$03,$04,$05,$06,$07

!align 255,0
x_tbl
    !byte $00,$00,$00,$00,$00,$00,$00,$00
    !byte $08,$08,$08,$08,$08,$08,$08,$08
    !byte $10,$10,$10,$10,$10,$10,$10,$10
    !byte $18,$18,$18,$18,$18,$18,$18,$18
    !byte $20,$20,$20,$20,$20,$20,$20,$20
    !byte $28,$28,$28,$28,$28,$28,$28,$28
    !byte $30,$30,$30,$30,$30,$30,$30,$30
    !byte $38,$38,$38,$38,$38,$38,$38,$38
    !byte $40,$40,$40,$40,$40,$40,$40,$40
    !byte $48,$48,$48,$48,$48,$48,$48,$48
    !byte $50,$50,$50,$50,$50,$50,$50,$50
    !byte $58,$58,$58,$58,$58,$58,$58,$58
    !byte $60,$60,$60,$60,$60,$60,$60,$60
    !byte $68,$68,$68,$68,$68,$68,$68,$68
    !byte $70,$70,$70,$70,$70,$70,$70,$70
    !byte $78,$78,$78,$78,$78,$78,$78,$78
    !byte $80,$80,$80,$80,$80,$80,$80,$80
    !byte $88,$88,$88,$88,$88,$88,$88,$88
    !byte $90,$90,$90,$90,$90,$90,$90,$90
    !byte $98,$98,$98,$98,$98,$98,$98,$98
    !byte $a0,$a0,$a0,$a0,$a0,$a0,$a0,$a0
    !byte $a8,$a8,$a8,$a8,$a8,$a8,$a8,$a8
    !byte $b0,$b0,$b0,$b0,$b0,$b0,$b0,$b0
    !byte $b8,$b8,$b8,$b8,$b8,$b8,$b8,$b8
    !byte $c0,$c0,$c0,$c0,$c0,$c0,$c0,$c0
    !byte $c8,$c8,$c8,$c8,$c8,$c8,$c8,$c8
    !byte $d0,$d0,$d0,$d0,$d0,$d0,$d0,$d0
    !byte $d8,$d8,$d8,$d8,$d8,$d8,$d8,$d8
    !byte $e0,$e0,$e0,$e0,$e0,$e0,$e0,$e0
    !byte $e8,$e8,$e8,$e8,$e8,$e8,$e8,$e8
    !byte $f0,$f0,$f0,$f0,$f0,$f0,$f0,$f0
    !byte $f8,$f8,$f8,$f8,$f8,$f8,$f8,$f8
